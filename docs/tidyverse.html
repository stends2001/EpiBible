<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Tidyverse | Epibible</title>
  <meta name="description" content="Chapter 5 Tidyverse | Epibible" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Tidyverse | Epibible" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Tidyverse | Epibible" />
  
  
  

<meta name="author" content="Sten de Schrijver" />


<meta name="date" content="2025-08-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="r-fundamentals.html"/>
<link rel="next" href="working-with-epidemiological-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Epibible</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the Author</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-epidemiology.html"><a href="introduction-to-epidemiology.html"><i class="fa fa-check"></i><b>1</b> Introduction to Epidemiology</a></li>
<li class="chapter" data-level="2" data-path="working-with-this-book.html"><a href="working-with-this-book.html"><i class="fa fa-check"></i><b>2</b> Working with this book</a>
<ul>
<li class="chapter" data-level="2.1" data-path="working-with-this-book.html"><a href="working-with-this-book.html#what-is-bookdown"><i class="fa fa-check"></i><b>2.1</b> What is bookdown?</a></li>
<li class="chapter" data-level="2.2" data-path="working-with-this-book.html"><a href="working-with-this-book.html#what-is-markdown"><i class="fa fa-check"></i><b>2.2</b> What is Markdown</a></li>
<li class="chapter" data-level="2.3" data-path="working-with-this-book.html"><a href="working-with-this-book.html#code-snippets"><i class="fa fa-check"></i><b>2.3</b> Code snippets</a></li>
<li class="chapter" data-level="2.4" data-path="working-with-this-book.html"><a href="working-with-this-book.html#other-formats-in-this-book"><i class="fa fa-check"></i><b>2.4</b> Other formats in this book</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html"><i class="fa fa-check"></i><b>3</b> Getting Started with R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#installing-r-and-rstudio"><i class="fa fa-check"></i><b>3.1</b> Installing R and Rstudio</a></li>
<li class="chapter" data-level="3.2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#starting-to-code"><i class="fa fa-check"></i><b>3.2</b> Starting to code</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="r-fundamentals.html"><a href="r-fundamentals.html"><i class="fa fa-check"></i><b>4</b> R fundamentals</a>
<ul>
<li class="chapter" data-level="4.1" data-path="r-fundamentals.html"><a href="r-fundamentals.html#r-syntax"><i class="fa fa-check"></i><b>4.1</b> R syntax</a></li>
<li class="chapter" data-level="4.2" data-path="r-fundamentals.html"><a href="r-fundamentals.html#troubleshooting"><i class="fa fa-check"></i><b>4.2</b> Troubleshooting</a></li>
<li class="chapter" data-level="4.3" data-path="r-fundamentals.html"><a href="r-fundamentals.html#data-structures"><i class="fa fa-check"></i><b>4.3</b> Data structures</a></li>
<li class="chapter" data-level="4.4" data-path="r-fundamentals.html"><a href="r-fundamentals.html#writing-scripts"><i class="fa fa-check"></i><b>4.4</b> writing scripts</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>5</b> Tidyverse</a>
<ul>
<li class="chapter" data-level="5.1" data-path="tidyverse.html"><a href="tidyverse.html#wide-and-tidy-data"><i class="fa fa-check"></i><b>5.1</b> Wide and tidy data</a></li>
<li class="chapter" data-level="5.2" data-path="tidyverse.html"><a href="tidyverse.html#data-wrangling-using-dplyr"><i class="fa fa-check"></i><b>5.2</b> Data wrangling using dplyr</a></li>
<li class="chapter" data-level="5.3" data-path="tidyverse.html"><a href="tidyverse.html#data-visualization-using-ggplot"><i class="fa fa-check"></i><b>5.3</b> Data visualization using ggplot</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="working-with-epidemiological-data.html"><a href="working-with-epidemiological-data.html"><i class="fa fa-check"></i><b>6</b> Working with epidemiological data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="working-with-epidemiological-data.html"><a href="working-with-epidemiological-data.html#acessing-data"><i class="fa fa-check"></i><b>6.1</b> Acessing data</a></li>
<li class="chapter" data-level="6.2" data-path="working-with-epidemiological-data.html"><a href="working-with-epidemiological-data.html#imperfect-epidemiological-data"><i class="fa fa-check"></i><b>6.2</b> (Imperfect) epidemiological data</a></li>
<li class="chapter" data-level="6.3" data-path="working-with-epidemiological-data.html"><a href="working-with-epidemiological-data.html#case-study-1-yellow-fever"><i class="fa fa-check"></i><b>6.3</b> Case Study 1: Yellow Fever</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="modelling.html"><a href="modelling.html"><i class="fa fa-check"></i><b>7</b> Modelling</a>
<ul>
<li class="chapter" data-level="7.1" data-path="modelling.html"><a href="modelling.html#compartmental-models"><i class="fa fa-check"></i><b>7.1</b> Compartmental models</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="modelling.html"><a href="modelling.html#sir-model-in-theory"><i class="fa fa-check"></i><b>7.1.1</b> SIR model in theory</a></li>
<li class="chapter" data-level="7.1.2" data-path="modelling.html"><a href="modelling.html#sir-model-in-r"><i class="fa fa-check"></i><b>7.1.2</b> SIR model in R</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="modelling.html"><a href="modelling.html#time-series---forecasting"><i class="fa fa-check"></i><b>7.2</b> Time series - Forecasting</a></li>
<li class="chapter" data-level="7.3" data-path="modelling.html"><a href="modelling.html#using-and-applying-models"><i class="fa fa-check"></i><b>7.3</b> Using and applying models</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="communication-and-sharing-of-code-and-data.html"><a href="communication-and-sharing-of-code-and-data.html"><i class="fa fa-check"></i><b>8</b> Communication and sharing of code and data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="communication-and-sharing-of-code-and-data.html"><a href="communication-and-sharing-of-code-and-data.html#writing-code-best-practices"><i class="fa fa-check"></i><b>8.1</b> Writing code: best practices</a></li>
<li class="chapter" data-level="8.2" data-path="communication-and-sharing-of-code-and-data.html"><a href="communication-and-sharing-of-code-and-data.html#github"><i class="fa fa-check"></i><b>8.2</b> Github</a></li>
<li class="chapter" data-level="8.3" data-path="communication-and-sharing-of-code-and-data.html"><a href="communication-and-sharing-of-code-and-data.html#reports-using-markdown"><i class="fa fa-check"></i><b>8.3</b> Reports using Markdown</a></li>
<li class="chapter" data-level="8.4" data-path="communication-and-sharing-of-code-and-data.html"><a href="communication-and-sharing-of-code-and-data.html#open-science"><i class="fa fa-check"></i><b>8.4</b> Open science</a></li>
<li class="chapter" data-level="8.5" data-path="communication-and-sharing-of-code-and-data.html"><a href="communication-and-sharing-of-code-and-data.html#communities-and-forums"><i class="fa fa-check"></i><b>8.5</b> Communities and forums</a></li>
<li class="chapter" data-level="8.6" data-path="communication-and-sharing-of-code-and-data.html"><a href="communication-and-sharing-of-code-and-data.html#how-to-use-chat-gpt"><i class="fa fa-check"></i><b>8.6</b> How to use Chat-GPT</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="recommended-reading.html"><a href="recommended-reading.html"><i class="fa fa-check"></i><b>9</b> Recommended Reading</a>
<ul>
<li class="chapter" data-level="9.1" data-path="recommended-reading.html"><a href="recommended-reading.html#recommended-textbooks-and-courses"><i class="fa fa-check"></i><b>9.1</b> Recommended textbooks and courses</a></li>
<li class="chapter" data-level="9.2" data-path="recommended-reading.html"><a href="recommended-reading.html#datasources"><i class="fa fa-check"></i><b>9.2</b> Datasources</a></li>
<li class="chapter" data-level="9.3" data-path="recommended-reading.html"><a href="recommended-reading.html#useful-packages"><i class="fa fa-check"></i><b>9.3</b> Useful packages</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Epibible</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidyverse" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Tidyverse<a href="tidyverse.html#tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The collection tidyverse includes some of the most widely used packages in R. Representing a collection of packages used for data cleaning, processing and visualization, every person familiar with R should know these packages! In this chapter we will be focussing on the implementation of the functions that make up the tidyverse, with a particular interest to data manipulation and visualization.</p>
<p>The packages in tidyverse work on dataframes which we saw in the previous chapter. In particular, the tidyverse is made for <strong>tidy</strong>-dataframes. Following Wickman’s philosophy, a tidy dataframe is one with the following features:</p>
<ul>
<li>each variable is a column</li>
<li>each observation is a row</li>
<li>each value is a cell</li>
</ul>
<div id="wide-and-tidy-data" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Wide and tidy data<a href="tidyverse.html#wide-and-tidy-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s go through an example together. Is the following table a tidy dataframe?</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="tidyverse.html#cb9-1" tabindex="-1"></a><span class="co"># Column-wise matrix: male_cases, female_cases, year</span></span>
<span id="cb9-2"><a href="tidyverse.html#cb9-2" tabindex="-1"></a>flu_cases <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb9-3"><a href="tidyverse.html#cb9-3" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">120</span>, <span class="dv">150</span>,   <span class="co"># male_cases</span></span>
<span id="cb9-4"><a href="tidyverse.html#cb9-4" tabindex="-1"></a>    <span class="dv">100</span>, <span class="dv">130</span>,   <span class="co"># female_cases</span></span>
<span id="cb9-5"><a href="tidyverse.html#cb9-5" tabindex="-1"></a>    <span class="dv">2020</span>, <span class="dv">2021</span>),<span class="co"># year</span></span>
<span id="cb9-6"><a href="tidyverse.html#cb9-6" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb9-7"><a href="tidyverse.html#cb9-7" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb9-8"><a href="tidyverse.html#cb9-8" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">FALSE</span>   <span class="co"># fill column-wise</span></span>
<span id="cb9-9"><a href="tidyverse.html#cb9-9" tabindex="-1"></a>)</span>
<span id="cb9-10"><a href="tidyverse.html#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="tidyverse.html#cb9-11" tabindex="-1"></a><span class="co"># Add column names</span></span>
<span id="cb9-12"><a href="tidyverse.html#cb9-12" tabindex="-1"></a><span class="fu">colnames</span>(flu_cases) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;male_cases&quot;</span>, <span class="st">&quot;female_cases&quot;</span>, <span class="st">&quot;year&quot;</span>)</span>
<span id="cb9-13"><a href="tidyverse.html#cb9-13" tabindex="-1"></a></span>
<span id="cb9-14"><a href="tidyverse.html#cb9-14" tabindex="-1"></a>flu_cases <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(flu_cases)</span>
<span id="cb9-15"><a href="tidyverse.html#cb9-15" tabindex="-1"></a>flu_cases</span></code></pre></div>
<pre><code>##   male_cases female_cases year
## 1        120          100 2020
## 2        150          130 2021</code></pre>
<p>The answer is no!
Here, the variable sex is stored inside the column names instead of as a proper column.</p>
<p>The tidyverse provides two key functions in the tidyr package to reshape data:</p>
<ul>
<li><code>pivot_longer()</code> → makes data longer (good for tidy analysis, many rows, fewer columns)</li>
<li><code>pivot_wider()</code> → makes data wider (the opposite transformation, more columns, fewer rows)</li>
</ul>
<p><strong>pivot_longer</strong></p>
<p>We can reshape our flu data into a tidy format:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="tidyverse.html#cb11-1" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb11-2"><a href="tidyverse.html#cb11-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="tidyverse.html#cb15-1" tabindex="-1"></a>flu_tidy <span class="ot">&lt;-</span> flu_cases <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="tidyverse.html#cb15-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb15-3"><a href="tidyverse.html#cb15-3" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(male_cases, female_cases),</span>
<span id="cb15-4"><a href="tidyverse.html#cb15-4" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;sex&quot;</span>,</span>
<span id="cb15-5"><a href="tidyverse.html#cb15-5" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;cases&quot;</span></span>
<span id="cb15-6"><a href="tidyverse.html#cb15-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="tidyverse.html#cb15-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">&quot;male_cases&quot;</span>, <span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>))</span>
<span id="cb15-8"><a href="tidyverse.html#cb15-8" tabindex="-1"></a></span>
<span id="cb15-9"><a href="tidyverse.html#cb15-9" tabindex="-1"></a>flu_tidy</span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
##    year sex    cases
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1  2020 male     120
## 2  2020 female   100
## 3  2021 male     150
## 4  2021 female   130</code></pre>
<p>Now indeed each variable (year, sex, cases) has its own column.
Tidy tables tend to be long, not wide — which is exactly what tidyverse functions expect.</p>
<p><strong>pivot_wider</strong></p>
<p>We can also go back to wide format:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="tidyverse.html#cb17-1" tabindex="-1"></a>flu_wide_again <span class="ot">&lt;-</span> flu_tidy <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="tidyverse.html#cb17-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb17-3"><a href="tidyverse.html#cb17-3" tabindex="-1"></a>    <span class="at">names_from =</span> sex,</span>
<span id="cb17-4"><a href="tidyverse.html#cb17-4" tabindex="-1"></a>    <span class="at">values_from =</span> cases,</span>
<span id="cb17-5"><a href="tidyverse.html#cb17-5" tabindex="-1"></a>    <span class="at">names_glue =</span> <span class="st">&quot;{sex}_cases&quot;</span></span>
<span id="cb17-6"><a href="tidyverse.html#cb17-6" tabindex="-1"></a>  )</span>
<span id="cb17-7"><a href="tidyverse.html#cb17-7" tabindex="-1"></a></span>
<span id="cb17-8"><a href="tidyverse.html#cb17-8" tabindex="-1"></a>flu_wide_again</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##    year male_cases female_cases
##   &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
## 1  2020        120          100
## 2  2021        150          130</code></pre>
<p>Now we are back to the original table, where sex is encoded in the column names.</p>
</div>
<div id="data-wrangling-using-dplyr" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Data wrangling using dplyr<a href="tidyverse.html#data-wrangling-using-dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There’s loads of functions within tidyverse. We will go through a couple of them together, using one of the default datasets in R, namely gapminder. This includes yearly observations per country in the world, of many variables as you’ll see. Then we’ll use what we learned on an epidemiological dataset to figure out the source of an outbreak!</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="tidyverse.html#cb19-1" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb19-2"><a href="tidyverse.html#cb19-2" tabindex="-1"></a><span class="fu">head</span>(gapminder)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   country     continent  year lifeExp      pop gdpPercap
##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
## 1 Afghanistan Asia       1952    28.8  8425333      779.
## 2 Afghanistan Asia       1957    30.3  9240934      821.
## 3 Afghanistan Asia       1962    32.0 10267083      853.
## 4 Afghanistan Asia       1967    34.0 11537966      836.
## 5 Afghanistan Asia       1972    36.1 13079460      740.
## 6 Afghanistan Asia       1977    38.4 14880372      786.</code></pre>
<p><strong>pipeline-operator</strong></p>
<p>We connect different tidyverse functions using a so called pipeline operator: <code>%&gt;%</code>. We can write it like:
<code>new_dataframe = old_dataframe %&gt;% tidyverse_function</code></p>
<p><strong>select</strong></p>
<p>Using the function <code>select()</code> we select specific column names</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="tidyverse.html#cb21-1" tabindex="-1"></a>selected_columns <span class="ot">=</span> gapminder <span class="sc">%&gt;%</span> <span class="fu">select</span>(country, year, lifeExp)</span>
<span id="cb21-2"><a href="tidyverse.html#cb21-2" tabindex="-1"></a><span class="fu">head</span>(selected_columns)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   country      year lifeExp
##   &lt;fct&gt;       &lt;int&gt;   &lt;dbl&gt;
## 1 Afghanistan  1952    28.8
## 2 Afghanistan  1957    30.3
## 3 Afghanistan  1962    32.0
## 4 Afghanistan  1967    34.0
## 5 Afghanistan  1972    36.1
## 6 Afghanistan  1977    38.4</code></pre>
<p><strong>filter</strong></p>
<p>The filter function is a very powerful function that allows us to only keep the rows in our dataframe that fulfill a certain condition. See chapter … for more conditional logic in R, but here’s a couple of examples</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="tidyverse.html#cb23-1" tabindex="-1"></a><span class="fu">head</span>(gapminder <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   country     continent  year lifeExp      pop gdpPercap
##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
## 1 Afghanistan Asia       2007    43.8 31889923      975.
## 2 Albania     Europe     2007    76.4  3600523     5937.
## 3 Algeria     Africa     2007    72.3 33333216     6223.
## 4 Angola      Africa     2007    42.7 12420476     4797.
## 5 Argentina   Americas   2007    75.3 40301927    12779.
## 6 Australia   Oceania    2007    81.2 20434176    34435.</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="tidyverse.html#cb25-1" tabindex="-1"></a><span class="fu">head</span>(gapminder <span class="sc">%&gt;%</span> <span class="fu">filter</span>(continent <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Oceania&#39;</span>, <span class="st">&#39;Africa&#39;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   country continent  year lifeExp      pop gdpPercap
##   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
## 1 Algeria Africa     1952    43.1  9279525     2449.
## 2 Algeria Africa     1957    45.7 10270856     3014.
## 3 Algeria Africa     1962    48.3 11000948     2551.
## 4 Algeria Africa     1967    51.4 12760499     3247.
## 5 Algeria Africa     1972    54.5 14760787     4183.
## 6 Algeria Africa     1977    58.0 17152804     4910.</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="tidyverse.html#cb27-1" tabindex="-1"></a><span class="fu">head</span>(gapminder <span class="sc">%&gt;%</span> <span class="fu">filter</span>(pop <span class="sc">&gt;</span> <span class="dv">100000000</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   country    continent  year lifeExp       pop gdpPercap
##   &lt;fct&gt;      &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
## 1 Bangladesh Asia       1987    52.8 103764241      752.
## 2 Bangladesh Asia       1992    56.0 113704579      838.
## 3 Bangladesh Asia       1997    59.4 123315288      973.
## 4 Bangladesh Asia       2002    62.0 135656790     1136.
## 5 Bangladesh Asia       2007    64.1 150448339     1391.
## 6 Brazil     Americas   1972    59.5 100840058     4986.</code></pre>
<p><strong>mutate</strong></p>
<p>This is another very powerful and useful function. With mutate, we can change values in a dataframe. We can even change values in a dataframe that fulfill a certain condition. We do this by
<code>mutate(column_name = ...)</code></p>
<p>if column_name doesn’t exist in the dataframe yet, a new column with this name is created.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="tidyverse.html#cb29-1" tabindex="-1"></a>gapminder_pop_log <span class="ot">=</span> gapminder <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">pop_log =</span> <span class="fu">log</span>(pop))</span>
<span id="cb29-2"><a href="tidyverse.html#cb29-2" tabindex="-1"></a>gapminder_pop_log</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 7
##    country     continent  year lifeExp      pop gdpPercap pop_log
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.    15.9
##  2 Afghanistan Asia       1957    30.3  9240934      821.    16.0
##  3 Afghanistan Asia       1962    32.0 10267083      853.    16.1
##  4 Afghanistan Asia       1967    34.0 11537966      836.    16.3
##  5 Afghanistan Asia       1972    36.1 13079460      740.    16.4
##  6 Afghanistan Asia       1977    38.4 14880372      786.    16.5
##  7 Afghanistan Asia       1982    39.9 12881816      978.    16.4
##  8 Afghanistan Asia       1987    40.8 13867957      852.    16.4
##  9 Afghanistan Asia       1992    41.7 16317921      649.    16.6
## 10 Afghanistan Asia       1997    41.8 22227415      635.    16.9
## # ℹ 1,694 more rows</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="tidyverse.html#cb31-1" tabindex="-1"></a><span class="co"># some case_when functionality...</span></span></code></pre></div>
<p><strong>Transmutate</strong></p>
<p>The function <code>transmutate()</code> does the same as <code>mutate()</code>, with the only difference being that exclusively the changed column is selected. Thus, <code>transmutate()</code> is a basically a combination of <code>mutate %&gt;% select</code>.</p>
<p><strong>Arrange</strong></p>
<p>The function <code>arrange()</code> does not actually change anything inside of hte dataframe, but only adjusts the order in which we see it. Based on one or more columns, the order of rows is changed. By default in ascending order (low to high). To change to descening values we add <code>desc</code> as follows</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="tidyverse.html#cb32-1" tabindex="-1"></a><span class="co"># get the smallest popularion sizes in 1992</span></span>
<span id="cb32-2"><a href="tidyverse.html#cb32-2" tabindex="-1"></a><span class="fu">head</span>(gapminder <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1992</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(pop))</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   country               continent  year lifeExp    pop gdpPercap
##   &lt;fct&gt;                 &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;  &lt;int&gt;     &lt;dbl&gt;
## 1 Sao Tome and Principe Africa     1992    62.7 125911     1429.
## 2 Iceland               Europe     1992    78.8 259012    25144.
## 3 Djibouti              Africa     1992    51.6 384156     2377.
## 4 Equatorial Guinea     Africa     1992    47.5 387838     1132.
## 5 Comoros               Africa     1992    57.9 454429     1247.
## 6 Bahrain               Asia       1992    72.6 529491    19036.</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="tidyverse.html#cb34-1" tabindex="-1"></a><span class="co"># get the highest life expectancies in 2007 in Africa</span></span>
<span id="cb34-2"><a href="tidyverse.html#cb34-2" tabindex="-1"></a><span class="fu">head</span>(gapminder <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">&#39;Africa&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(lifeExp)))</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   country   continent  year lifeExp      pop gdpPercap
##   &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
## 1 Reunion   Africa     2007    76.4   798094     7670.
## 2 Libya     Africa     2007    74.0  6036914    12057.
## 3 Tunisia   Africa     2007    73.9 10276158     7093.
## 4 Mauritius Africa     2007    72.8  1250882    10957.
## 5 Algeria   Africa     2007    72.3 33333216     6223.
## 6 Egypt     Africa     2007    71.3 80264543     5581.</code></pre>
<p><strong>group_by</strong></p>
<p>The function <code>group_by()</code> allows us to group rows in a dataframe based on one or more columns. This does not yet change the dataframe values but rather sets up a grouped structure that works especially well with functions like <code>summarise()</code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="tidyverse.html#cb36-1" tabindex="-1"></a><span class="co"># group the data by continent</span></span>
<span id="cb36-2"><a href="tidyverse.html#cb36-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(continent)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 × 6
## # Groups:   continent [5]
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.
## # ℹ 1,694 more rows</code></pre>
<p>Notice nothing much looks different yet — but now the data is grouped internally. To see its power, we usually combine it with <code>summarise()</code>.</p>
<p><strong>summarise</strong></p>
<p>The function <code>summarise()</code> (or <code>summarize()</code>) lets us reduce each group to one row by applying summary functions such as <code>mean()</code>, <code>sum()</code>, <code>n()</code> (count rows), etc.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="tidyverse.html#cb38-1" tabindex="-1"></a><span class="co"># average life expectancy per continent in 2007</span></span>
<span id="cb38-2"><a href="tidyverse.html#cb38-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="tidyverse.html#cb38-3" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="tidyverse.html#cb38-4" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb38-5"><a href="tidyverse.html#cb38-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_lifeExp =</span> <span class="fu">mean</span>(lifeExp))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   continent mean_lifeExp
##   &lt;fct&gt;            &lt;dbl&gt;
## 1 Africa            54.8
## 2 Americas          73.6
## 3 Asia              70.7
## 4 Europe            77.6
## 5 Oceania           80.7</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="tidyverse.html#cb40-1" tabindex="-1"></a><span class="co"># total population per continent in 2007</span></span>
<span id="cb40-2"><a href="tidyverse.html#cb40-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="tidyverse.html#cb40-3" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="tidyverse.html#cb40-4" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href="tidyverse.html#cb40-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_pop =</span> <span class="fu">sum</span>(pop))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   continent  total_pop
##   &lt;fct&gt;          &lt;dbl&gt;
## 1 Africa     929539692
## 2 Americas   898871184
## 3 Asia      3811953827
## 4 Europe     586098529
## 5 Oceania     24549947</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="tidyverse.html#cb42-1" tabindex="-1"></a><span class="co"># combine multiple summaries</span></span>
<span id="cb42-2"><a href="tidyverse.html#cb42-2" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="tidyverse.html#cb42-3" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="tidyverse.html#cb42-4" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb42-5"><a href="tidyverse.html#cb42-5" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb42-6"><a href="tidyverse.html#cb42-6" tabindex="-1"></a>    <span class="at">mean_lifeExp =</span> <span class="fu">mean</span>(lifeExp),</span>
<span id="cb42-7"><a href="tidyverse.html#cb42-7" tabindex="-1"></a>    <span class="at">sd_lifeExp =</span> <span class="fu">sd</span>(lifeExp),</span>
<span id="cb42-8"><a href="tidyverse.html#cb42-8" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="fu">sum</span>(pop),</span>
<span id="cb42-9"><a href="tidyverse.html#cb42-9" tabindex="-1"></a>    <span class="at">n_countries =</span> <span class="fu">n</span>()</span>
<span id="cb42-10"><a href="tidyverse.html#cb42-10" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   continent mean_lifeExp sd_lifeExp  total_pop n_countries
##   &lt;fct&gt;            &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;       &lt;int&gt;
## 1 Africa            54.8      9.63   929539692          52
## 2 Americas          73.6      4.44   898871184          25
## 3 Asia              70.7      7.96  3811953827          33
## 4 Europe            77.6      2.98   586098529          30
## 5 Oceania           80.7      0.729   24549947           2</code></pre>
</div>
<div id="data-visualization-using-ggplot" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Data visualization using ggplot<a href="tidyverse.html#data-visualization-using-ggplot" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="r-fundamentals.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="working-with-epidemiological-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/stends2001/EpiBible/blob/main05-tidyverse.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["EpiBible.pdf", "EpiBible.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
