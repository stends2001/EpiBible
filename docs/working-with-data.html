<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Working with data | Epibible</title>
  <meta name="description" content="Chapter 4 Working with data | Epibible" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Working with data | Epibible" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Working with data | Epibible" />
  
  
  

<meta name="author" content="Sten de Schrijver" />


<meta name="date" content="2025-08-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-to-epidemiology.html"/>
<link rel="next" href="modelling.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a></li>
<li class="chapter" data-level="3" data-path="introduction-to-epidemiology.html"><a href="introduction-to-epidemiology.html"><i class="fa fa-check"></i><b>3</b> Introduction to Epidemiology</a></li>
<li class="chapter" data-level="4" data-path="working-with-data.html"><a href="working-with-data.html"><i class="fa fa-check"></i><b>4</b> Working with data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="working-with-data.html"><a href="working-with-data.html#installing-packages"><i class="fa fa-check"></i><b>4.1</b> Installing packages</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="working-with-data.html"><a href="working-with-data.html#installing-world-shapedata"><i class="fa fa-check"></i><b>4.1.1</b> Installing world shapedata</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="working-with-data.html"><a href="working-with-data.html#case-study-yellow-fever"><i class="fa fa-check"></i><b>4.2</b> Case study: Yellow Fever</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="modelling.html"><a href="modelling.html"><i class="fa fa-check"></i><b>5</b> Modelling</a>
<ul>
<li class="chapter" data-level="5.1" data-path="modelling.html"><a href="modelling.html#compartmental-models"><i class="fa fa-check"></i><b>5.1</b> Compartmental models</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="modelling.html"><a href="modelling.html#sir-model-in-theory"><i class="fa fa-check"></i><b>5.1.1</b> SIR model in theory</a></li>
<li class="chapter" data-level="5.1.2" data-path="modelling.html"><a href="modelling.html#sir-model-in-r"><i class="fa fa-check"></i><b>5.1.2</b> SIR model in R</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="modelling.html"><a href="modelling.html#forecasting"><i class="fa fa-check"></i><b>5.2</b> Forecasting</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Epibible</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-with-data" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Working with data<a href="working-with-data.html#working-with-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Data is at the heart of epidemiology. We look at where and when diseases occur, to hopefully better understand their origin or their cause, how to prevent or cure the disease, or to make predictions about the future. That’s why epidemiologists need to be able to work with disease data, and know how and where to look for it! That’s why in this chapter we go over some data-extraction, processing, visualization and analysis. We start simple, with an example of Yellow Fever, and then get into more complex case in which we try to understand cholera outbreaks.</p>
<div id="installing-packages" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Installing packages<a href="working-with-data.html#installing-packages" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="working-with-data.html#cb1-1" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-2"><a href="working-with-data.html#cb1-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
## ✔ dplyr     1.1.4     ✔ readr     2.1.5
## ✔ forcats   1.0.0     ✔ stringr   1.5.1
## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
## ✔ purrr     1.0.2     
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ readr::col_factor() masks scales::col_factor()
## ✖ purrr::discard()    masks scales::discard()
## ✖ dplyr::filter()     masks stats::filter()
## ✖ dplyr::lag()        masks stats::lag()
## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="working-with-data.html#cb3-1" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb3-2"><a href="working-with-data.html#cb3-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-3"><a href="working-with-data.html#cb3-3" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb3-4"><a href="working-with-data.html#cb3-4" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;rnaturalearthdata&#39;
## 
## The following object is masked from &#39;package:rnaturalearth&#39;:
## 
##     countries110</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="working-with-data.html#cb5-1" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb5-2"><a href="working-with-data.html#cb5-2" tabindex="-1"></a><span class="fu">library</span>(sf)   </span></code></pre></div>
<pre><code>## Linking to GEOS 3.11.2, GDAL 3.8.2, PROJ 9.3.1; sf_use_s2() is TRUE</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="working-with-data.html#cb7-1" tabindex="-1"></a><span class="fu">library</span>(glue)</span></code></pre></div>
<div id="installing-world-shapedata" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Installing world shapedata<a href="working-with-data.html#installing-world-shapedata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Eventually, I want to show you how to make some plots and some maps. For that, we need to load the shape of the world, so that we can fill in countries with certain colors and such. For that we’ll load the <strong>world shapefile</strong> from the package <em>rnaturalearth</em>. This dataset includes many different columns, but we only require some of them; name, geometry and continent.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="working-with-data.html#cb8-1" tabindex="-1"></a>world_shapefile              <span class="ot">=</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">&quot;medium&quot;</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;geometry&quot;</span>, <span class="st">&quot;continent&quot;</span>))</span>
<span id="cb8-2"><a href="working-with-data.html#cb8-2" tabindex="-1"></a><span class="fu">colnames</span>(world_shapefile)[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>)</span>
<span id="cb8-3"><a href="working-with-data.html#cb8-3" tabindex="-1"></a>continents_list              <span class="ot">=</span> <span class="fu">unique</span>(world_shapefile<span class="sc">$</span>continent)</span>
<span id="cb8-4"><a href="working-with-data.html#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="working-with-data.html#cb8-5" tabindex="-1"></a>countries_continents <span class="ot">&lt;-</span> world_shapefile <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="working-with-data.html#cb8-6" tabindex="-1"></a>  <span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="working-with-data.html#cb8-7" tabindex="-1"></a>  <span class="fu">select</span>(country, continent)</span>
<span id="cb8-8"><a href="working-with-data.html#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="working-with-data.html#cb8-9" tabindex="-1"></a><span class="co"># World map</span></span>
<span id="cb8-10"><a href="working-with-data.html#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="working-with-data.html#cb8-11" tabindex="-1"></a><span class="fu">ggplot</span>(world_shapefile) <span class="sc">+</span></span>
<span id="cb8-12"><a href="working-with-data.html#cb8-12" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> continent), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb8-13"><a href="working-with-data.html#cb8-13" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb8-14"><a href="working-with-data.html#cb8-14" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb8-15"><a href="working-with-data.html#cb8-15" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">&#39;world shapefile&#39;</span>,</span>
<span id="cb8-16"><a href="working-with-data.html#cb8-16" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb8-17"><a href="working-with-data.html#cb8-17" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb8-18"><a href="working-with-data.html#cb8-18" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#f7f9fc&quot;</span>),</span>
<span id="cb8-19"><a href="working-with-data.html#cb8-19" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb8-20"><a href="working-with-data.html#cb8-20" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb8-21"><a href="working-with-data.html#cb8-21" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb8-22"><a href="working-with-data.html#cb8-22" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="02-working-with-data_files/figure-html/unnamed-chunk-2-1.png" width="1344" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="case-study-yellow-fever" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Case study: Yellow Fever<a href="working-with-data.html#case-study-yellow-fever" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Context</strong>
Yellow fever (YF) is a severe and sometimes fatal hemorrhagic fever caused by a flavivirus with a single-stranded, negatively oriented RNA genome. It primarily affects regions in Africa and Latin America, where the virus sustains itself through a sylvatic cycle involving wild mosquitoes and non-human primates. In Brazil, for instance, mosquito species like Haemagogus and Sabethes maintain this cycle in forested areas. While a highly effective vaccine exists, yellow fever outbreaks still occur, particularly when the virus spills over into urban settings.</p>
<p>Historically, yellow fever was confined to Africa until the transatlantic slave trade introduced it to Latin America, where favorable climates and mosquito vectors allowed it to take root. Cities like New Orleans suffered repeated, devastating outbreaks in the past. Brazil saw a decline in cases mid-20th century, but a resurgence occurred between 2016 and 2018, with over 2,000 reported cases and a strikingly high death toll of 681. This resurgence was partly driven by the spread of the virus into urban areas, facilitated by Aedes aegypti and Aedes albopictus, mosquitoes that thrive in cities. Curiously, yellow fever has never established itself in Asia despite the presence of competent vectors and similar arboviruses, a mystery that may relate to immunological cross-reactivity with other flaviviruses like dengue.</p>
<p>(Reference: Chippaux, 2018: <a href="https://doi.org/10.1186/s40409-018-0162-y" class="uri">https://doi.org/10.1186/s40409-018-0162-y</a>)</p>
<p>The WHO has data data available for download for many different things, including casenumbers for many infectious diseases, including that for YF. The raw data for YF you can find <a href="https://www.who.int/data/gho/data/indicators/indicator-details/GHO/yellow-fever-number-of-reported-cases">here</a>. I have cleaned this data a little so that the dataframe is as concise as possible, and so that all the countrynames correctly map to the ones in the <strong>world_shapefile</strong> dataset.</p>
<p><strong>import data</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="working-with-data.html#cb9-1" tabindex="-1"></a>who_yellowfever <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/cleaned_yellowfever.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 4029 Columns: 3
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): country
## dbl (2): year, cases
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="working-with-data.html#cb11-1" tabindex="-1"></a><span class="fu">head</span>(who_yellowfever)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   country            year cases
##   &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;
## 1 Algeria            2024     0
## 2 Andorra            2024     0
## 3 Anguilla           2024     0
## 4 Antigua and Barb.  2024     0
## 5 Armenia            2024     0
## 6 Aruba              2024     0</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="working-with-data.html#cb13-1" tabindex="-1"></a>n_countries <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(who_yellowfever<span class="sc">$</span>country))</span>
<span id="cb13-2"><a href="working-with-data.html#cb13-2" tabindex="-1"></a>first_year  <span class="ot">=</span> <span class="fu">min</span>(who_yellowfever<span class="sc">$</span>year)</span>
<span id="cb13-3"><a href="working-with-data.html#cb13-3" tabindex="-1"></a>last_year   <span class="ot">=</span> <span class="fu">max</span>(who_yellowfever<span class="sc">$</span>year)</span>
<span id="cb13-4"><a href="working-with-data.html#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="working-with-data.html#cb13-5" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">The dataframe contains yearly casedata for {n_countries} countries between {first_year} and {last_year}&quot;</span>)</span></code></pre></div>
<pre><code>## The dataframe contains yearly casedata for 212 countries between 1974 and 2024</code></pre>
<p><strong>Global yearly cases</strong>
Let’s first get a global overview of YF in the world the past 50 years. To start with, we will create a graph showing the number of cases in the world per year, and then we’ll show it per continent to see which are the ones most affected.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="working-with-data.html#cb15-1" tabindex="-1"></a><span class="co"># Global epicurve</span></span>
<span id="cb15-2"><a href="working-with-data.html#cb15-2" tabindex="-1"></a>global_yearly_casenumbers <span class="ot">&lt;-</span> who_yellowfever <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="working-with-data.html#cb15-3" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="working-with-data.html#cb15-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cases =</span> <span class="fu">sum</span>(cases))</span>
<span id="cb15-5"><a href="working-with-data.html#cb15-5" tabindex="-1"></a></span>
<span id="cb15-6"><a href="working-with-data.html#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="working-with-data.html#cb15-7" tabindex="-1"></a><span class="fu">ggplot</span>(global_yearly_casenumbers) <span class="sc">+</span> </span>
<span id="cb15-8"><a href="working-with-data.html#cb15-8" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> cases), <span class="at">color =</span> <span class="st">&#39;black&#39;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span>  <span class="co"># black outline</span></span>
<span id="cb15-9"><a href="working-with-data.html#cb15-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> cases), <span class="at">color =</span> <span class="st">&#39;#ffcc00&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># yellow line</span></span>
<span id="cb15-10"><a href="working-with-data.html#cb15-10" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">pretty_breaks</span>(<span class="at">n =</span> <span class="dv">20</span>)) <span class="sc">+</span>                <span class="co"># I don&#39;t want a break per year. I do a max of 20 year</span></span>
<span id="cb15-11"><a href="working-with-data.html#cb15-11" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">14</span>)  <span class="sc">+</span> </span>
<span id="cb15-12"><a href="working-with-data.html#cb15-12" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-13"><a href="working-with-data.html#cb15-13" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb15-14"><a href="working-with-data.html#cb15-14" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Yellow Fever Cases in the world 1974 - 2024&quot;</span>,</span>
<span id="cb15-15"><a href="working-with-data.html#cb15-15" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;number of cases reported to the WHO&quot;</span></span>
<span id="cb15-16"><a href="working-with-data.html#cb15-16" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<p><img src="02-working-with-data_files/figure-html/unnamed-chunk-4-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p><strong>Yearly cases per continent</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="working-with-data.html#cb17-1" tabindex="-1"></a>yearly_casenumbers_continent <span class="ot">=</span> <span class="fu">merge</span>(who_yellowfever, countries_continents, <span class="at">by =</span> <span class="st">&quot;country&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="working-with-data.html#cb17-2" tabindex="-1"></a>  <span class="fu">group_by</span>(year, continent) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="working-with-data.html#cb17-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cases =</span> <span class="fu">sum</span>(cases)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="working-with-data.html#cb17-4" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">%in%</span> continents_list)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="working-with-data.html#cb19-1" tabindex="-1"></a><span class="fu">ggplot</span>(yearly_casenumbers_continent) <span class="sc">+</span> </span>
<span id="cb19-2"><a href="working-with-data.html#cb19-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> cases, <span class="at">color =</span> continent), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb19-3"><a href="working-with-data.html#cb19-3" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">pretty_breaks</span>(<span class="at">n =</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb19-4"><a href="working-with-data.html#cb19-4" tabindex="-1"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span> </span>
<span id="cb19-5"><a href="working-with-data.html#cb19-5" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span>  <span class="co"># 7 distinct colors</span></span>
<span id="cb19-6"><a href="working-with-data.html#cb19-6" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-7"><a href="working-with-data.html#cb19-7" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb19-8"><a href="working-with-data.html#cb19-8" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Yellow Fever Cases in the world 1973 - 2024 per continent&quot;</span>,</span>
<span id="cb19-9"><a href="working-with-data.html#cb19-9" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;number of cases reported to the WHO&quot;</span></span>
<span id="cb19-10"><a href="working-with-data.html#cb19-10" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-11"><a href="working-with-data.html#cb19-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="02-working-with-data_files/figure-html/unnamed-chunk-5-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>We can clearly tell that since 1974, Africa has experienced the largest burden by YF, though South America suffered between 2016 and 2019 as well. Let’s have a look at the total sum of cases per country in the past, to see which countries and which areas are affected the most.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="working-with-data.html#cb20-1" tabindex="-1"></a>cases_per_country <span class="ot">=</span> who_yellowfever<span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="working-with-data.html#cb20-2" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="working-with-data.html#cb20-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cases =</span> <span class="fu">sum</span>(cases))</span>
<span id="cb20-4"><a href="working-with-data.html#cb20-4" tabindex="-1"></a></span>
<span id="cb20-5"><a href="working-with-data.html#cb20-5" tabindex="-1"></a>mapdata <span class="ot">=</span> <span class="fu">st_as_sf</span>(<span class="fu">merge</span>(cases_per_country, world_shapefile, <span class="at">on =</span> <span class="st">&#39;country&#39;</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>))</span>
<span id="cb20-6"><a href="working-with-data.html#cb20-6" tabindex="-1"></a></span>
<span id="cb20-7"><a href="working-with-data.html#cb20-7" tabindex="-1"></a></span>
<span id="cb20-8"><a href="working-with-data.html#cb20-8" tabindex="-1"></a>mapdata<span class="sc">$</span>cases_category <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb20-9"><a href="working-with-data.html#cb20-9" tabindex="-1"></a>  mapdata<span class="sc">$</span>cases,</span>
<span id="cb20-10"><a href="working-with-data.html#cb20-10" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">5000</span>, <span class="dv">10000</span>, <span class="dv">20000</span>, <span class="cn">Inf</span>),  <span class="co"># 8 breaks → 7 intervals</span></span>
<span id="cb20-11"><a href="working-with-data.html#cb20-11" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0 - 100&quot;</span>, <span class="st">&quot;101-500&quot;</span>,<span class="st">&quot;501-1000&quot;</span>,     <span class="st">&quot;1001-2000&quot;</span>,   <span class="st">&quot;2001-5000&quot;</span>,    <span class="st">&quot;5001-10000&quot;</span>,  <span class="st">&quot;10001-20000&quot;</span>,  <span class="st">&quot;&gt;20000&quot;</span>),</span>
<span id="cb20-12"><a href="working-with-data.html#cb20-12" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb20-13"><a href="working-with-data.html#cb20-13" tabindex="-1"></a>)</span>
<span id="cb20-14"><a href="working-with-data.html#cb20-14" tabindex="-1"></a></span>
<span id="cb20-15"><a href="working-with-data.html#cb20-15" tabindex="-1"></a></span>
<span id="cb20-16"><a href="working-with-data.html#cb20-16" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mapdata) <span class="sc">+</span></span>
<span id="cb20-17"><a href="working-with-data.html#cb20-17" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> cases_category), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb20-18"><a href="working-with-data.html#cb20-18" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;YlOrRd&quot;</span>, <span class="at">na.value =</span> <span class="st">&quot;gray95&quot;</span>, <span class="at">name =</span> <span class="st">&quot;Cases&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-19"><a href="working-with-data.html#cb20-19" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb20-20"><a href="working-with-data.html#cb20-20" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb20-21"><a href="working-with-data.html#cb20-21" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#E0FFFF&quot;</span>),  <span class="co"># clean light background</span></span>
<span id="cb20-22"><a href="working-with-data.html#cb20-22" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb20-23"><a href="working-with-data.html#cb20-23" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb20-24"><a href="working-with-data.html#cb20-24" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb20-25"><a href="working-with-data.html#cb20-25" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb20-26"><a href="working-with-data.html#cb20-26" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;Cumulative cases 1974 - 2024&#39;</span>)</span>
<span id="cb20-27"><a href="working-with-data.html#cb20-27" tabindex="-1"></a></span>
<span id="cb20-28"><a href="working-with-data.html#cb20-28" tabindex="-1"></a>pl</span></code></pre></div>
<p><img src="02-working-with-data_files/figure-html/unnamed-chunk-6-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>From this we can clearly see that the most affected regions are central and west Africa, as well as central(?) Latin America. This does not allow us to look into temporal dynamics though, so let’s look a bit further into that using a function.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="working-with-data.html#cb21-1" tabindex="-1"></a>plot_country <span class="ot">=</span> <span class="cf">function</span>(country_filter){</span>
<span id="cb21-2"><a href="working-with-data.html#cb21-2" tabindex="-1"></a>  </span>
<span id="cb21-3"><a href="working-with-data.html#cb21-3" tabindex="-1"></a>  filtered_df <span class="ot">&lt;-</span> who_yellowfever <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country <span class="sc">==</span> country_filter)</span>
<span id="cb21-4"><a href="working-with-data.html#cb21-4" tabindex="-1"></a></span>
<span id="cb21-5"><a href="working-with-data.html#cb21-5" tabindex="-1"></a>  pl <span class="ot">=</span> <span class="fu">ggplot</span>(filtered_df) <span class="sc">+</span> </span>
<span id="cb21-6"><a href="working-with-data.html#cb21-6" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> cases), <span class="at">color =</span> <span class="st">&#39;black&#39;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span>  <span class="co"># black outline</span></span>
<span id="cb21-7"><a href="working-with-data.html#cb21-7" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> cases), <span class="at">color =</span> <span class="st">&#39;#ffcc00&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># yellow line</span></span>
<span id="cb21-8"><a href="working-with-data.html#cb21-8" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> cases), <span class="at">color =</span> <span class="st">&#39;black&#39;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># black outline</span></span>
<span id="cb21-9"><a href="working-with-data.html#cb21-9" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">pretty_breaks</span>(<span class="at">n =</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb21-10"><a href="working-with-data.html#cb21-10" tabindex="-1"></a>      <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">14</span>)  <span class="sc">+</span> </span>
<span id="cb21-11"><a href="working-with-data.html#cb21-11" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y=</span><span class="st">&#39;cases&#39;</span>) <span class="sc">+</span></span>
<span id="cb21-12"><a href="working-with-data.html#cb21-12" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb21-13"><a href="working-with-data.html#cb21-13" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&quot;Yellow Fever Cases in &quot;</span>, country_filter,  <span class="st">&quot; 1973 - 2024&quot;</span>),</span>
<span id="cb21-14"><a href="working-with-data.html#cb21-14" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">&quot;number of cases reported to the WHO&quot;</span></span>
<span id="cb21-15"><a href="working-with-data.html#cb21-15" tabindex="-1"></a>    )</span>
<span id="cb21-16"><a href="working-with-data.html#cb21-16" tabindex="-1"></a>  </span>
<span id="cb21-17"><a href="working-with-data.html#cb21-17" tabindex="-1"></a>  <span class="fu">return</span>(pl)</span>
<span id="cb21-18"><a href="working-with-data.html#cb21-18" tabindex="-1"></a>  </span>
<span id="cb21-19"><a href="working-with-data.html#cb21-19" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="working-with-data.html#cb22-1" tabindex="-1"></a><span class="fu">plot_country</span>(<span class="st">&quot;Dem. Rep. Congo&quot;</span>)</span></code></pre></div>
<p><img src="02-working-with-data_files/figure-html/unnamed-chunk-8-1.png" width="1440" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="working-with-data.html#cb23-1" tabindex="-1"></a><span class="fu">plot_country</span>(<span class="st">&quot;Chad&quot;</span>)</span></code></pre></div>
<p><img src="02-working-with-data_files/figure-html/unnamed-chunk-8-2.png" width="1440" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="working-with-data.html#cb24-1" tabindex="-1"></a><span class="fu">plot_country</span>(<span class="st">&quot;Nigeria&quot;</span>)</span></code></pre></div>
<p><img src="02-working-with-data_files/figure-html/unnamed-chunk-8-3.png" width="1440" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="working-with-data.html#cb25-1" tabindex="-1"></a><span class="fu">plot_country</span>(<span class="st">&quot;Ghana&quot;</span>)</span></code></pre></div>
<p><img src="02-working-with-data_files/figure-html/unnamed-chunk-8-4.png" width="1440" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="working-with-data.html#cb26-1" tabindex="-1"></a><span class="fu">plot_country</span>(<span class="st">&quot;Brazil&quot;</span>)</span></code></pre></div>
<p><img src="02-working-with-data_files/figure-html/unnamed-chunk-8-5.png" width="1440" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="working-with-data.html#cb27-1" tabindex="-1"></a><span class="fu">plot_country</span>(<span class="st">&quot;Peru&quot;</span>)</span></code></pre></div>
<p><img src="02-working-with-data_files/figure-html/unnamed-chunk-8-6.png" width="1440" style="display: block; margin: auto;" />
This is actually already interesting! We can see that some many of these countries have very big outbreaks in a specific year, or over a couple of years, while a peak in one country doesn’t necessarily translate in one elsewhere. Peru, for example, had a big outbreak in 1995, and hasn’t had many cases since. Brazil, however, did not report manby cases until 2017 when it detected a huge outbreak that lasted until 2018.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-to-epidemiology.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modelling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/stends2001/EpiBible/blob/main02-working-with-data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["mybook.pdf", "mybook.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
